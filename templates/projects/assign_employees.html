{% extends 'base.html' %}

{% block title %}Assign Employees - {{ project.name }} - Bridgio CRM{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto space-y-6">
    <div class="flex justify-between items-center">
        <div>
            <h1 class="text-3xl font-heading font-bold text-olive-primary">Assign Employees</h1>
            <p class="text-gray-600 mt-1">{{ project.name }}</p>
        </div>
        <a href="{% url 'projects:detail' project.pk %}" class="text-olive-primary hover:text-olive-secondary">‚Üê Back to Project</a>
    </div>
    
    <div class="bg-white rounded-custom shadow-md p-6">
        <form method="post" class="space-y-6">
            {% csrf_token %}
            
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                <p class="text-sm text-blue-800">
                    <strong>Instructions:</strong> Select employees (Closing Managers, Sourcing Managers, and Telecallers) to assign to this project. 
                    You can assign multiple employees. Employees assigned to this project will be able to work on leads from this project.
                </p>
            </div>
            
            <!-- Closing Managers -->
            <div>
                <h2 class="text-xl font-heading font-semibold mb-4 pb-2 border-b border-gray-200">Closing Managers</h2>
                {% if employees_by_role.closing_manager %}
                <div class="space-y-2">
                    {% for item in employees_by_role.closing_manager %}
                    <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer border {% if item.is_assigned %}border-green-500 bg-green-50{% else %}border-gray-200{% endif %}">
                        <input type="checkbox" name="employees" value="{{ item.employee.id }}" 
                               {% if item.is_assigned %}checked{% endif %}
                               class="w-4 h-4 text-olive-primary border-gray-300 rounded focus:ring-olive-primary">
                        <div class="ml-3 flex-1">
                            <p class="font-medium text-gray-900">{{ item.employee.get_full_name|default:item.employee.username }}</p>
                            <p class="text-sm text-gray-500">{{ item.employee.email|default:"No email" }}</p>
                        </div>
                        {% if item.is_assigned %}
                        <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">Currently Assigned</span>
                        {% endif %}
                    </label>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-gray-500 text-center py-4">No closing managers available.</p>
                {% endif %}
            </div>
            
            <!-- Sourcing Managers -->
            <div>
                <h2 class="text-xl font-heading font-semibold mb-4 pb-2 border-b border-gray-200">Sourcing Managers</h2>
                {% if employees_by_role.sourcing_manager %}
                <div class="space-y-2">
                    {% for item in employees_by_role.sourcing_manager %}
                    <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer border {% if item.is_assigned %}border-green-500 bg-green-50{% else %}border-gray-200{% endif %}">
                        <input type="checkbox" name="employees" value="{{ item.employee.id }}" 
                               {% if item.is_assigned %}checked{% endif %}
                               class="w-4 h-4 text-olive-primary border-gray-300 rounded focus:ring-olive-primary">
                        <div class="ml-3 flex-1">
                            <p class="font-medium text-gray-900">{{ item.employee.get_full_name|default:item.employee.username }}</p>
                            <p class="text-sm text-gray-500">{{ item.employee.email|default:"No email" }}</p>
                        </div>
                        {% if item.is_assigned %}
                        <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">Currently Assigned</span>
                        {% endif %}
                    </label>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-gray-500 text-center py-4">No sourcing managers available.</p>
                {% endif %}
            </div>
            
            <!-- Telecallers -->
            <div>
                <h2 class="text-xl font-heading font-semibold mb-4 pb-2 border-b border-gray-200">Telecallers</h2>
                {% if employees_by_role.telecaller %}
                <div class="space-y-2">
                    {% for item in employees_by_role.telecaller %}
                    <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer border {% if item.is_assigned %}border-green-500 bg-green-50{% else %}border-gray-200{% endif %}">
                        <input type="checkbox" name="employees" value="{{ item.employee.id }}" 
                               {% if item.is_assigned %}checked{% endif %}
                               class="w-4 h-4 text-olive-primary border-gray-300 rounded focus:ring-olive-primary">
                        <div class="ml-3 flex-1">
                            <p class="font-medium text-gray-900">{{ item.employee.get_full_name|default:item.employee.username }}</p>
                            <p class="text-sm text-gray-500">{{ item.employee.email|default:"No email" }}</p>
                        </div>
                        {% if item.is_assigned %}
                        <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">Currently Assigned</span>
                        {% endif %}
                    </label>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-gray-500 text-center py-4">No telecallers available.</p>
                {% endif %}
            </div>
            
            <div class="flex justify-end space-x-4 pt-4 border-t border-gray-200">
                <a href="{% url 'projects:detail' project.pk %}" 
                   class="px-6 py-2 border border-gray-300 rounded-custom hover:bg-gray-50 transition">
                    Cancel
                </a>
                <button type="submit" 
                        class="px-6 py-2 bg-olive-primary text-white rounded-custom hover:bg-olive-secondary transition">
                    Save Assignments
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

